<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="using:ConverterApp"
        mc:Ignorable="d"
        x:Class="ConverterApp.MainWindow"
        x:DataType="local:MainWindowViewModel"
        Width="720" Height="520"
        Title=".qcow2 ↔ .img Converter">
  <Grid RowDefinitions="Auto,*" Margin="14">
    <StackPanel Spacing="12">
      <TextBlock Text=".qcow2 ↔ .img Converter" FontSize="20" FontWeight="SemiBold"/>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="Input file" Width="90" VerticalAlignment="Center"/>
        <TextBox Text="{Binding InputPath, Mode=TwoWay}" MinWidth="380"/>
        <Button Content="Browse…" Command="{Binding BrowseInputCommand}" IsEnabled="{Binding IsIdle}" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="Output file" Width="90" VerticalAlignment="Center"/>
        <TextBox Text="{Binding OutputPath, Mode=TwoWay}" MinWidth="380"/>
        <Button Content="Pick folder…" Command="{Binding BrowseOutputDirectoryCommand}" IsEnabled="{Binding IsIdle}" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="Target format" Width="90" VerticalAlignment="Center"/>
        <StackPanel Orientation="Horizontal" Spacing="12">
          <RadioButton Content="Convert to .img (raw)" IsChecked="{Binding IsTargetRaw, Mode=TwoWay}" IsEnabled="{Binding IsIdle}"/>
          <RadioButton Content="Convert to .qcow2" IsChecked="{Binding IsTargetQcow2, Mode=TwoWay}" IsEnabled="{Binding IsIdle}"/>
        </StackPanel>
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="qemu-img" Width="90" VerticalAlignment="Center"/>
        <TextBox Text="{Binding QemuPath, Mode=TwoWay}" MinWidth="380"/>
        <Button Content="Browse…" Command="{Binding BrowseQemuCommand}" IsEnabled="{Binding IsIdle}" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="10">
        <Button Content="Convert" Command="{Binding StartCommand}" IsEnabled="{Binding CanStart}" Width="110" />
        <Button Content="Cancel" Command="{Binding CancelCommand}" IsEnabled="{Binding IsConverting}" Width="110" />
        <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" Margin="6,0,0,0"/>
      </StackPanel>

      <StackPanel Spacing="6">
        <ProgressBar Minimum="0" Maximum="100" Value="{Binding Progress}" Height="16"/>
        <TextBlock Text="{Binding ProgressLabel}" FontSize="12" Foreground="Gray"/>
      </StackPanel>

      <DockPanel LastChildFill="True">
        <TextBlock Text="Log" Margin="0,0,0,4"/>
      </DockPanel>
    </StackPanel>

    <Border Grid.Row="1" BorderThickness="1" BorderBrush="#DDD" Margin="0,10,0,0">
      <TextBox Text="{Binding LogText}" IsReadOnly="True" AcceptsReturn="True"
               ScrollViewer.VerticalScrollBarVisibility="Auto"
               ScrollViewer.HorizontalScrollBarVisibility="Auto" />
    </Border>
  </Grid>
</Window>
